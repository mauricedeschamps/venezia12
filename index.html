<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flemish Verbs Master</title>
    <meta name="description" content="Learn Flemish verbs with audio and examples">
    <meta name="theme-color" content="#2c3e50">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192x192.png">
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-color: #3498db;
            --card-bg: #2d2d2d;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .light-mode {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --accent-color: #3498db;
            --card-bg: #ffffff;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-hidden {
            display: none;
        }

        .filter-btn {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 2px solid var(--accent-color);
        }

        .filter-btn.active {
            background: var(--accent-color);
            color: white;
        }

        .search-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        #search {
            width: 70%;
            padding: 12px 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 2px solid var(--accent-color);
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
        }

        .verbs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .verb-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .verb-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .verb-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .verb-dutch {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .verb-translation {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .verb-example {
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 10px;
            color: var(--text-secondary);
            line-height: 1.5;
            position: relative;
        }

        .example-text {
            font-style: italic;
            margin-bottom: 10px;
        }

        .example-translation {
            font-size: 0.9rem;
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .audio-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .audio-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .audio-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .audio-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .conjugation {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .conjugation span {
            display: inline-block;
            margin-right: 8px;
            margin-bottom: 5px;
            background: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .contact-link {
            color: var(--accent-color);
            text-decoration: none;
        }

        .contact-link:hover {
            text-decoration: underline;
        }

        .stats {
            margin: 10px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .install-info {
            margin: 10px 0;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .audio-loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .verbs-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            #search {
                width: 90%;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
            }

            .audio-controls {
                flex-direction: column;
            }

            .audio-btn {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .verbs-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <header>
            <h1 id="app-title">Flemish Verbs Master</h1>
            <p class="subtitle" id="app-subtitle">Learn 50 essential Flemish verbs with audio and examples</p>
            
            <div class="controls">
                <button class="btn" id="theme-toggle">ðŸŒ™ Light Mode</button>
                <button class="btn btn-outline" id="language-toggle">ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž</button>
                <button class="btn btn-hidden" id="install-btn">ðŸ“± Install App</button>
                <button class="btn btn-success btn-hidden" id="installed-btn">âœ… Installed</button>
            </div>

            <div class="install-info" id="install-info">
                For best experience: Tap <span class="browser-share">ðŸ“±</span> in your browser and select "Add to Home Screen"
            </div>

            <div class="controls">
                <button class="btn filter-btn active" data-filter="all">All Verbs</button>
                <button class="btn filter-btn" data-filter="common">Common Verbs</button>
                <button class="btn filter-btn" data-filter="action">Action Verbs</button>
                <button class="btn filter-btn" data-filter="daily">Daily Life</button>
            </div>
            
            <div class="search-container">
                <input type="text" id="search" placeholder="Search verbs...">
            </div>
            <div class="stats" id="stats">Showing 50 verbs</div>
        </header>
        
        <main>
            <div class="verbs-grid" id="verbs-container">
                <!-- Verbs will be loaded here by JavaScript -->
            </div>
        </main>
        
        <footer>
            <p id="contact-text">Contact us<br>
                <a href="mailto:mementomorikatsu@gmail.com" class="contact-link">mementomorikatsu@gmail.com</a>
            </p>
        </footer>
    </div>

    <script>
        // Language texts
        const translations = {
            en: {
                title: "Flemish Verbs Master",
                subtitle: "Learn 50 essential Flemish verbs with audio and examples",
                searchPlaceholder: "Search verbs...",
                themeToggle: "ðŸŒ™ Light Mode",
                languageToggle: "ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž",
                installBtn: "ðŸ“± Install App",
                installedBtn: "âœ… Installed",
                contact: "Contact us",
                playVerb: "Play Verb",
                playExample: "Play Example",
                playing: "Playing...",
                stats: "Showing {count} verbs",
                installInfo: "For best experience: Tap ðŸ“± in your browser and select \"Add to Home Screen\"",
                installPrompt: "Install Flemish Verbs Master?",
                installInstructions: "To install this app: look for the Add to Home Screen option in your browser menu."
            },
            ja: {
                title: "ãƒ•ãƒ©ãƒžãƒ³èªžå‹•è©žãƒžã‚¹ã‚¿ãƒ¼",
                subtitle: "éŸ³å£°ä»˜ãã§50ã®åŸºæœ¬ãƒ•ãƒ©ãƒžãƒ³èªžå‹•è©žã‚’å­¦ã³ã¾ã—ã‚‡ã†",
                searchPlaceholder: "å‹•è©žã‚’æ¤œç´¢...",
                themeToggle: "ðŸŒ™ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰",
                languageToggle: "ðŸ‡ºðŸ‡¸ English",
                installBtn: "ðŸ“± ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«",
                installedBtn: "âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿",
                contact: "ãŠå•ã„åˆã‚ã›",
                playVerb: "å‹•è©žã‚’å†ç”Ÿ",
                playExample: "ä¾‹æ–‡ã‚’å†ç”Ÿ",
                playing: "å†ç”Ÿä¸­...",
                stats: "{count}å€‹ã®å‹•è©žã‚’è¡¨ç¤ºä¸­",
                installInfo: "ã‚ˆã‚Šè‰¯ã„ä½“é¨“ã®ãŸã‚ã«: ãƒ–ãƒ©ã‚¦ã‚¶ã®ðŸ“±ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’é¸æŠžã—ã¦ãã ã•ã„",
                installPrompt: "ãƒ•ãƒ©ãƒžãƒ³èªžå‹•è©žãƒžã‚¹ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã‹ï¼Ÿ",
                installInstructions: "ã“ã®ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŽ¢ã—ã¦ãã ã•ã„ã€‚"
            }
        };

        // Verb data - 50 verbs with example sentences in Dutch only for audio
        const verbs = [
            // ... (verbs data remains the same as previous version)
            // ã“ã“ã«å‰å›žã¨åŒã˜50å€‹ã®å‹•è©žãƒ‡ãƒ¼ã‚¿ã‚’é…ç½®
            {
                dutch: "zijn",
                translations: { en: "to be", ja: "ï½žã§ã‚ã‚‹" },
                examples: {
                    en: "Ik ben student. (I am a student)",
                    ja: "Ik ben student. (ç§ã¯å­¦ç”Ÿã§ã™)",
                    audio: "Ik ben student."
                },
                conjugation: ["ben", "bent", "is", "zijn"],
                category: "common"
            },
            // ... ä»–ã®å‹•è©žãƒ‡ãƒ¼ã‚¿ã‚‚åŒæ§˜ã«ç¶šã
        ];

        let currentLanguage = 'en';
        let currentTheme = 'dark';
        let currentFilter = 'all';
        let currentSpeech = null;
        let deferredPrompt = null;
        let isInstalled = false;

        // Initialize app
        function initApp() {
            renderVerbs();
            setupEventListeners();
            registerServiceWorker();
            updateStats();
            checkPWAInstallation();
        }

        // Check if PWA is already installed
        function checkPWAInstallation() {
            // Check if app is running in standalone mode (installed)
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                isInstalled = true;
                updateInstallButton();
            }
            
            // Check via beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                updateInstallButton();
            });

            // Listen for app installed event
            window.addEventListener('appinstalled', () => {
                isInstalled = true;
                deferredPrompt = null;
                updateInstallButton();
                showInstallSuccess();
            });
        }

        // Update install button state
        function updateInstallButton() {
            const installBtn = document.getElementById('install-btn');
            const installedBtn = document.getElementById('installed-btn');
            const installInfo = document.getElementById('install-info');

            if (isInstalled) {
                installBtn.classList.add('btn-hidden');
                installedBtn.classList.remove('btn-hidden');
                installInfo.style.display = 'none';
            } else if (deferredPrompt) {
                installBtn.classList.remove('btn-hidden');
                installedBtn.classList.add('btn-hidden');
                installInfo.style.display = 'block';
            } else {
                installBtn.classList.add('btn-hidden');
                installedBtn.classList.add('btn-hidden');
                installInfo.style.display = 'block';
            }
        }

        // Show install success message
        function showInstallSuccess() {
            // You can add a toast notification here if desired
            console.log('PWA was installed successfully');
        }

        // Install PWA
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        isInstalled = true;
                        updateInstallButton();
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            } else {
                // Fallback for browsers that don't support beforeinstallprompt
                const installInfo = document.getElementById('install-info');
                installInfo.innerHTML = translations[currentLanguage].installInstructions;
                installInfo.style.display = 'block';
            }
        }

        // Render verbs to the grid
        function renderVerbs(filter = "all") {
            const container = document.getElementById('verbs-container');
            container.innerHTML = '';
            
            const filteredVerbs = filter === "all" ? verbs : verbs.filter(verb => verb.category === filter);
            
            filteredVerbs.forEach(verb => {
                const card = document.createElement('div');
                card.className = 'verb-card';
                card.innerHTML = `
                    <div class="verb-header">
                        <div class="verb-dutch">${verb.dutch}</div>
                        <div class="verb-translation">${verb.translations[currentLanguage]}</div>
                    </div>
                    <div class="verb-example">
                        <div class="example-text">${verb.examples[currentLanguage].split(' (')[0]}</div>
                        <div class="example-translation">${verb.examples[currentLanguage].split(' (')[1]?.replace(')', '') || ''}</div>
                    </div>
                    <div class="conjugation">
                        ${verb.conjugation.map(form => `<span>${form}</span>`).join('')}
                    </div>
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="playAudio('${verb.dutch}', this)">
                            ðŸ”Š ${translations[currentLanguage].playVerb}
                        </button>
                        <button class="audio-btn" onclick="playExample('${verb.dutch}', this)">
                            ðŸŽµ ${translations[currentLanguage].playExample}
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
            updateStats();
        }

        // Update stats
        function updateStats() {
            const filteredVerbs = currentFilter === "all" ? verbs : verbs.filter(verb => verb.category === currentFilter);
            const statsElement = document.getElementById('stats');
            const text = translations[currentLanguage].stats.replace('{count}', filteredVerbs.length);
            statsElement.textContent = text;
        }

        // Play verb audio
        function playAudio(verb, button) {
            if (currentSpeech) {
                speechSynthesis.cancel();
            }

            const originalText = button.innerHTML;
            button.innerHTML = '<span class="audio-loading"></span> ' + translations[currentLanguage].playing;
            button.disabled = true;

            const utterance = new SpeechSynthesisUtterance(verb);
            utterance.lang = 'nl-NL';
            utterance.rate = 0.8;
            utterance.pitch = 1.0;

            utterance.onend = () => {
                button.innerHTML = originalText;
                button.disabled = false;
                currentSpeech = null;
            };

            utterance.onerror = () => {
                button.innerHTML = originalText;
                button.disabled = false;
                currentSpeech = null;
            };

            currentSpeech = utterance;
            speechSynthesis.speak(utterance);
        }

        // Play example audio
        function playExample(verb, button) {
            if (currentSpeech) {
                speechSynthesis.cancel();
            }

            const verbData = verbs.find(v => v.dutch === verb);
            if (!verbData) return;

            const originalText = button.innerHTML;
            button.innerHTML = '<span class="audio-loading"></span> ' + translations[currentLanguage].playing;
            button.disabled = true;

            const utterance = new SpeechSynthesisUtterance(verbData.examples.audio);
            utterance.lang = 'nl-NL';
            utterance.rate = 0.7;
            utterance.pitch = 1.0;

            utterance.onend = () => {
                button.innerHTML = originalText;
                button.disabled = false;
                currentSpeech = null;
            };

            utterance.onerror = () => {
                button.innerHTML = originalText;
                button.disabled = false;
                currentSpeech = null;
            };

            currentSpeech = utterance;
            speechSynthesis.speak(utterance);
        }

        // Toggle theme
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            
            if (currentTheme === 'dark') {
                body.classList.add('light-mode');
                body.classList.remove('dark-mode');
                themeToggle.textContent = currentLanguage === 'en' ? 'ðŸŒ™ Dark Mode' : 'ðŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰';
                currentTheme = 'light';
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                themeToggle.textContent = currentLanguage === 'en' ? 'ðŸŒ™ Light Mode' : 'ðŸŒ™ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰';
                currentTheme = 'dark';
            }
        }

        // Toggle language
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ja' : 'en';
            updateTexts();
            renderVerbs(currentFilter);
            updateInstallButton();
        }

        // Update all texts based on current language
        function updateTexts() {
            const t = translations[currentLanguage];
            document.getElementById('app-title').textContent = t.title;
            document.getElementById('app-subtitle').textContent = t.subtitle;
            document.getElementById('search').placeholder = t.searchPlaceholder;
            document.getElementById('theme-toggle').textContent = t.themeToggle;
            document.getElementById('language-toggle').textContent = t.languageToggle;
            document.getElementById('install-btn').textContent = t.installBtn;
            document.getElementById('installed-btn').textContent = t.installedBtn;
            document.getElementById('install-info').textContent = t.installInfo;
            document.getElementById('contact-text').innerHTML = `${t.contact}<br>
                <a href="mailto:mementomorikatsu@gmail.com" class="contact-link">mementomorikatsu@gmail.com</a>`;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            document.getElementById('search').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const cards = document.querySelectorAll('.verb-card');
                
                cards.forEach(card => {
                    const dutchWord = card.querySelector('.verb-dutch').textContent.toLowerCase();
                    const translation = card.querySelector('.verb-translation').textContent.toLowerCase();
                    
                    if (dutchWord.includes(searchTerm) || translation.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });

            // Theme toggle
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

            // Language toggle
            document.getElementById('language-toggle').addEventListener('click', toggleLanguage);

            // Install app
            document.getElementById('install-btn').addEventListener('click', installApp);

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.getAttribute('data-filter');
                    renderVerbs(currentFilter);
                });
            });
        }

        // Register service worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(error => {
                        console.log('SW registration failed: ', error);
                    });
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>